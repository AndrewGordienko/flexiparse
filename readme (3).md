
# OpenSearch Data Export Tool

The **OpenSearch Data Export Tool** is a Python script designed to dynamically parse and export data from OpenSearch JSON API responses into a structured CSV format. It automates the process of extracting and transforming unstructured JSON data from OpenSearch into a well-formatted DataFrame, which can then be exported for further analysis or reporting.

## Features

- **Dynamic Field Extraction:** Recursively parses JSON responses from OpenSearch without hardcoding specific fields, making it reusable for different types of data and reports.
- **Support for Aggregations:** Handles common OpenSearch aggregation types like `terms`, `date_histogram`, and metric aggregations (`sum`, `count`, `avg`, `max`, `min`, `value_count`).
- **SMS Usage Detection:** Flags and processes SMS-related data when detected in the field names.
- **Customizable Column Ordering:** Dynamically orders DataFrame columns based on field priority, with special handling for volume and metric columns.
- **CSV Export:** Exports parsed data into CSV files for further manipulation, tracking, or alerting systems.

## Installation

1. Clone this repository:

   ```bash
   git clone https://github.com/yourusername/opensearch-data-export-tool.git
   ```

2. Install the required dependencies using `pip`:

   ```bash
   pip install pandas
   ```

   Ensure the following dependencies are installed:
   - `pandas`
   - `json`

## Usage

To use the script, run the `process_data` function with the request and response JSON files from OpenSearch. This function will parse the response data and export it as a CSV file.

### Example Usage

1. **Run the script with your request and response files**:

   ```bash
   python main.py <request_file.json> <response_file.json> <output.csv>
   ```

2. **Code Example**:

   Here's how you can invoke the `process_data` function in your own Python environment:

   ```python
   from main import process_data

   request_file = 'request.json'
   response_file = 'response.json'
   output_csv = 'output.csv'

   process_data(request_file, response_file, output_csv)
   ```

This will read the OpenSearch query and response JSON files, process the data, and generate a CSV file named `output.csv`.

## Input Files

### Request File

- The request file should contain the OpenSearch aggregation query. This is used to map field names and understand the structure of the response.

### Response File

- The response file contains the OpenSearch aggregation results. The script dynamically processes these results into a table format.

### Output

- The output will be a CSV file structured similarly to the visualization in your OpenSearch GUI, making it easy to import the data into other systems for analysis.

## Project Structure

- **main.py:** The core script containing logic to process and export OpenSearch data.
- **request.json:** Example request file containing the OpenSearch query structure.
- **response.json:** Example response file containing the aggregation results.
- **output.csv:** The CSV output generated by the script.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
